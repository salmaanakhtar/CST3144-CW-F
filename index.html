<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lessons App</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <header class="header">
        <div class="logo-section">
          <div class="logo">L</div>
          <h1 class="app-name">{{ appName }}</h1>
        </div>
        <div class="nav-buttons">
          <button
            class="nav-btn lessons-btn"
            @click="goToLessons"
            v-if="currentPage !== 'lessons'">
            Lessons
          </button>
          <button
            class="nav-btn cart-btn"
            @click="goToCart"
            v-if="getTotalCartItems() > 0">
            Cart ({{ getTotalCartItems() }})
          </button>
        </div>
      </header>

      <div class="main-content" v-if="currentPage === 'lessons'">
        <h2>Available Lessons</h2>

        <div class="search-sort-container">
          <div class="search-bar">
            <input
              type="text"
              v-model="searchQuery"
              placeholder="Search lessons by subject, location..."
              class="search-input" />
          </div>

          <div class="sort-controls">
            <select v-model="sortBy" class="sort-select">
              <option value="">Sort by...</option>
              <option value="subject">Subject</option>
              <option value="location">Location</option>
              <option value="price">Price</option>
              <option value="spaces">Available Spaces</option>
            </select>

            <button
              @click="toggleSortOrder"
              class="sort-order-btn"
              v-if="sortBy"
              :class="{ 'desc': sortOrder === 'desc' }">
              {{ sortOrder === 'asc' ? '↑' : '↓' }}
            </button>
          </div>
        </div>

        <div class="lessons-container">
          <div
            class="lesson-card"
            v-for="lesson in filteredAndSortedLessons"
            :key="lesson.id">
            <h3 class="lesson-subject">{{ lesson.subject }}</h3>
            <div class="lesson-details">
              <p><strong>Location:</strong> {{ lesson.location }}</p>
              <p><strong>Price:</strong> ${{ lesson.price }}</p>
              <p>
                <strong>Available Spaces:</strong> {{ getAvailableSpaces(lesson)
                }}
              </p>
            </div>
            <button
              class="add-to-cart-btn"
              @click="addToCart(lesson)"
              :disabled="getAvailableSpaces(lesson) === 0"
              :class="{ 'disabled': getAvailableSpaces(lesson) === 0 }">
              {{ getAvailableSpaces(lesson) === 0 ? 'No Spaces Available' : 'Add
              to Cart' }}
            </button>
          </div>
        </div>

        <div v-if="filteredAndSortedLessons.length === 0" class="no-results">
          <p>No lessons found matching your search criteria.</p>
        </div>
      </div>

      <div class="main-content" v-if="currentPage === 'checkout'">
        <h2>Checkout</h2>

        <div class="cart-section">
          <h3>Your Cart</h3>
          <div v-if="cart.length === 0" class="empty-cart">
            <p>Your cart is empty</p>
          </div>
          <div v-else class="cart-items">
            <div class="cart-item" v-for="item in cart" :key="item.id">
              <div class="cart-item-info">
                <h4>{{ item.subject }}</h4>
                <p><strong>Location:</strong> {{ item.location }}</p>
                <p><strong>Price:</strong> ${{ item.price }} each</p>
                <p><strong>Quantity:</strong> {{ item.quantity }}</p>
                <p>
                  <strong>Subtotal:</strong> ${{ (item.price *
                  item.quantity).toFixed(2) }}
                </p>
              </div>
              <div class="cart-item-actions">
                <button @click="removeFromCart(item.id)" class="remove-btn">
                  Remove
                </button>
                <button
                  @click="decreaseQuantity(item.id)"
                  class="decrease-btn"
                  v-if="item.quantity > 1">
                  -
                </button>
                <button
                  @click="increaseQuantity(item)"
                  class="increase-btn"
                  v-if="getAvailableSpaces(item) > 0">
                  +
                </button>
              </div>
            </div>
            <div class="cart-total">
              <h3>Total: ${{ getCartTotal() }}</h3>
            </div>
          </div>
        </div>

        <div class="checkout-form-section">
          <h3>Checkout Information</h3>
          <form class="checkout-form">
            <div class="form-group">
              <label for="firstName">First Name:</label>
              <input
                type="text"
                id="firstName"
                v-model="checkoutForm.firstName"
                @blur="validateField('firstName')"
                :class="{ 'error': validationErrors.firstName, 'valid': checkoutForm.firstName && !validationErrors.firstName }"
                required />
              <div v-if="validationErrors.firstName" class="error-message">
                {{ validationErrors.firstName }}
              </div>
            </div>

            <div class="form-group">
              <label for="lastName">Last Name:</label>
              <input
                type="text"
                id="lastName"
                v-model="checkoutForm.lastName"
                @blur="validateField('lastName')"
                :class="{ 'error': validationErrors.lastName, 'valid': checkoutForm.lastName && !validationErrors.lastName }"
                required />
              <div v-if="validationErrors.lastName" class="error-message">
                {{ validationErrors.lastName }}
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                v-model="checkoutForm.email"
                @blur="validateField('email')"
                :class="{ 'error': validationErrors.email, 'valid': checkoutForm.email && !validationErrors.email }"
                required />
              <div v-if="validationErrors.email" class="error-message">
                {{ validationErrors.email }}
              </div>
            </div>

            <div class="form-group">
              <label for="phone">Phone Number:</label>
              <input
                type="tel"
                id="phone"
                v-model="checkoutForm.phone"
                @blur="validateField('phone')"
                :class="{ 'error': validationErrors.phone, 'valid': checkoutForm.phone && !validationErrors.phone }"
                placeholder="(123) 456-7890"
                required />
              <div v-if="validationErrors.phone" class="error-message">
                {{ validationErrors.phone }}
              </div>
            </div>

            <div class="form-group">
              <label for="address">Address:</label>
              <textarea
                id="address"
                v-model="checkoutForm.address"
                @blur="validateField('address')"
                :class="{ 'error': validationErrors.address, 'valid': checkoutForm.address && !validationErrors.address }"
                required></textarea>
              <div v-if="validationErrors.address" class="error-message">
                {{ validationErrors.address }}
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City:</label>
                <input
                  type="text"
                  id="city"
                  v-model="checkoutForm.city"
                  @blur="validateField('city')"
                  :class="{ 'error': validationErrors.city, 'valid': checkoutForm.city && !validationErrors.city }"
                  required />
                <div v-if="validationErrors.city" class="error-message">
                  {{ validationErrors.city }}
                </div>
              </div>

              <div class="form-group">
                <label for="country">Country:</label>
                <select 
                  id="country" 
                  v-model="checkoutForm.country"
                  @change="validateField('country')"
                  :class="{ 'error': validationErrors.country, 'valid': checkoutForm.country && !validationErrors.country }"
                  required>
                  <option value="">Select Country</option>
                  <option value="United States">United States</option>
                  <option value="United Kingdom">United Kingdom</option>
                  <option value="Canada">Canada</option>
                  <option value="Australia">Australia</option>
                  <option value="Germany">Germany</option>
                  <option value="France">France</option>
                  <option value="Italy">Italy</option>
                  <option value="Spain">Spain</option>
                  <option value="Netherlands">Netherlands</option>
                  <option value="Japan">Japan</option>
                  <option value="Other">Other</option>
                </select>
                <div v-if="validationErrors.country" class="error-message">
                  {{ validationErrors.country }}
                </div>
              </div>
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" v-model="checkoutForm.isGift" />
                <span class="checkmark"></span>
                This is a gift
              </label>
            </div>

            <div class="form-group" v-if="checkoutForm.isGift">
              <label for="recipientName">Recipient's Name:</label>
              <input
                type="text"
                id="recipientName"
                v-model="checkoutForm.recipientName"
                @blur="validateField('recipientName')"
                :class="{ 'error': validationErrors.recipientName, 'valid': checkoutForm.recipientName && !validationErrors.recipientName }"
                required />
              <div v-if="validationErrors.recipientName" class="error-message">
                {{ validationErrors.recipientName }}
              </div>
            </div>

            <div class="form-group radio-group">
              <label class="form-label">Delivery Instructions:</label>
              <div class="radio-options">
                <label class="radio-label">
                  <input
                    type="radio"
                    name="deliveryOption"
                    value="leaveAtDoor"
                    v-model="checkoutForm.deliveryOption"
                    @change="validateField('deliveryOption')" />
                  <span class="radio-mark"></span>
                  Leave at door
                </label>
                <label class="radio-label">
                  <input
                    type="radio"
                    name="deliveryOption"
                    value="ringBell"
                    v-model="checkoutForm.deliveryOption"
                    @change="validateField('deliveryOption')" />
                  <span class="radio-mark"></span>
                  Ring bell
                </label>
              </div>
              <div v-if="validationErrors.deliveryOption" class="error-message">
                {{ validationErrors.deliveryOption }}
              </div>
            </div>

            <button
              type="submit"
              class="checkout-btn"
              :class="{ 'disabled': !isFormValid }"
              :disabled="!isFormValid"
              @click.prevent="processCheckout">
              Complete Purchase - ${{ getCartTotal() }}
            </button>
          </form>
        </div>
      </div>
    </div>
    <script>
      new Vue({
        el: "#app",
        data: {
          appName: "Learning App",
          currentPage: "lessons",
          cart: [],
          searchQuery: "",
          sortBy: "",
          sortOrder: "asc",
          checkoutForm: {
            firstName: "",
            lastName: "",
            email: "",
            phone: "",
            address: "",
            city: "",
            country: "",
            isGift: false,
            recipientName: "",
            deliveryOption: "",
          },
          validationErrors: {
            firstName: "",
            lastName: "",
            email: "",
            phone: "",
            address: "",
            city: "",
            country: "",
            recipientName: "",
            deliveryOption: "",
          },
          lessons: [
            {
              id: 1,
              subject: "Mathematics",
              location: "New York",
              price: 25,
              spaces: 5,
            },
            {
              id: 2,
              subject: "Physics",
              location: "Los Angeles",
              price: 30,
              spaces: 8,
            },
            {
              id: 3,
              subject: "Chemistry",
              location: "Chicago",
              price: 28,
              spaces: 6,
            },
            {
              id: 4,
              subject: "Biology",
              location: "Houston",
              price: 27,
              spaces: 7,
            },
            {
              id: 5,
              subject: "English",
              location: "Philadelphia",
              price: 22,
              spaces: 10,
            },
            {
              id: 6,
              subject: "History",
              location: "Phoenix",
              price: 20,
              spaces: 12,
            },
            {
              id: 7,
              subject: "Computer Science",
              location: "San Antonio",
              price: 35,
              spaces: 4,
            },
            {
              id: 8,
              subject: "Art",
              location: "San Diego",
              price: 24,
              spaces: 9,
            },
            {
              id: 9,
              subject: "Music",
              location: "Dallas",
              price: 26,
              spaces: 6,
            },
            {
              id: 10,
              subject: "Psychology",
              location: "San Jose",
              price: 29,
              spaces: 5,
            },
          ],
        },
        computed: {
          filteredAndSortedLessons() {
            let filtered = this.lessons;

            if (this.searchQuery) {
              const query = this.searchQuery.toLowerCase();
              filtered = filtered.filter(
                (lesson) =>
                  lesson.subject.toLowerCase().includes(query) ||
                  lesson.location.toLowerCase().includes(query)
              );
            }

            if (this.sortBy) {
              filtered = [...filtered].sort((a, b) => {
                let valueA, valueB;

                if (this.sortBy === "spaces") {
                  valueA = this.getAvailableSpaces(a);
                  valueB = this.getAvailableSpaces(b);
                } else {
                  valueA = a[this.sortBy];
                  valueB = b[this.sortBy];

                  if (typeof valueA === "string") {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                  }
                }

                if (this.sortOrder === "asc") {
                  return valueA < valueB ? -1 : valueA > valueB ? 1 : 0;
                } else {
                  return valueA > valueB ? -1 : valueA < valueB ? 1 : 0;
                }
              });
            }

            return filtered;
          },
          isFormValid() {
            const form = this.checkoutForm;
            
            if (!form.firstName.trim() || !form.lastName.trim() || 
                !form.email.trim() || !form.phone.trim() || 
                !form.address.trim() || !form.city.trim() || 
                !form.country || !form.deliveryOption) {
              return false;
            }
            
            if (form.isGift && !form.recipientName.trim()) {
              return false;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(form.email)) {
              return false;
            }
            
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,15}$/;
            if (!phoneRegex.test(form.phone.replace(/\s/g, ''))) {
              return false;
            }
            
            const nameRegex = /^[A-Za-z\s\-\']+$/;
            if (!nameRegex.test(form.firstName) || !nameRegex.test(form.lastName)) {
              return false;
            }
            
            if (!nameRegex.test(form.city)) {
              return false;
            }
            
            if (form.isGift && !nameRegex.test(form.recipientName)) {
              return false;
            }
            
            return true;
          },
        },
        methods: {
          toggleSortOrder() {
            this.sortOrder = this.sortOrder === "asc" ? "desc" : "asc";
          },
          validateField(fieldName) {
            const form = this.checkoutForm;
            const value = form[fieldName];
            
            this.validationErrors[fieldName] = '';
            
            switch(fieldName) {
              case 'firstName':
              case 'lastName':
                if (!value.trim()) {
                  this.validationErrors[fieldName] = `${fieldName === 'firstName' ? 'First' : 'Last'} name is required`;
                } else if (value.length < 2) {
                  this.validationErrors[fieldName] = 'Name must be at least 2 characters';
                } else if (!/^[A-Za-z\s\-\']+$/.test(value)) {
                  this.validationErrors[fieldName] = 'Name can only contain letters, spaces, hyphens, and apostrophes';
                }
                break;
                
              case 'email':
                if (!value.trim()) {
                  this.validationErrors[fieldName] = 'Email is required';
                } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                  this.validationErrors[fieldName] = 'Please enter a valid email address';
                }
                break;
                
              case 'phone':
                if (!value.trim()) {
                  this.validationErrors[fieldName] = 'Phone number is required';
                } else if (!/^[\+]?[0-9\s\-\(\)]{10,15}$/.test(value.replace(/\s/g, ''))) {
                  this.validationErrors[fieldName] = 'Please enter a valid phone number (10-15 digits)';
                }
                break;
                
              case 'address':
                if (!value.trim()) {
                  this.validationErrors[fieldName] = 'Address is required';
                } else if (value.length < 5) {
                  this.validationErrors[fieldName] = 'Address must be at least 5 characters';
                }
                break;
                
              case 'city':
                if (!value.trim()) {
                  this.validationErrors[fieldName] = 'City is required';
                } else if (value.length < 2) {
                  this.validationErrors[fieldName] = 'City must be at least 2 characters';
                } else if (!/^[A-Za-z\s\-\']+$/.test(value)) {
                  this.validationErrors[fieldName] = 'City can only contain letters, spaces, hyphens, and apostrophes';
                }
                break;
                
              case 'country':
                if (!value) {
                  this.validationErrors[fieldName] = 'Please select a country';
                }
                break;
                
              case 'recipientName':
                if (form.isGift) {
                  if (!value.trim()) {
                    this.validationErrors[fieldName] = 'Recipient name is required for gifts';
                  } else if (value.length < 2) {
                    this.validationErrors[fieldName] = 'Recipient name must be at least 2 characters';
                  } else if (!/^[A-Za-z\s\-\']+$/.test(value)) {
                    this.validationErrors[fieldName] = 'Name can only contain letters, spaces, hyphens, and apostrophes';
                  }
                }
                break;
                
              case 'deliveryOption':
                if (!value) {
                  this.validationErrors[fieldName] = 'Please select a delivery option';
                }
                break;
            }
          },
          goToLessons() {
            this.currentPage = "lessons";
          },
          goToCart() {
            this.currentPage = "checkout";
          },
          getCartTotal() {
            return this.cart
              .reduce((total, item) => total + item.price * item.quantity, 0)
              .toFixed(2);
          },
          processCheckout() {
            this.validateField('firstName');
            this.validateField('lastName');
            this.validateField('email');
            this.validateField('phone');
            this.validateField('address');
            this.validateField('city');
            this.validateField('country');
            this.validateField('deliveryOption');
            
            if (this.checkoutForm.isGift) {
              this.validateField('recipientName');
            }
            
            if (!this.isFormValid) {
              alert('Please correct the errors in the form before proceeding.');
              return;
            }
            
            alert('Order processed successfully! Thank you for your purchase.');
            console.log("Checkout form data:", this.checkoutForm);
            console.log("Cart contents:", this.cart);
          },
          getTotalCartItems() {
            return this.cart.reduce((total, item) => total + item.quantity, 0);
          },
          getAvailableSpaces(lesson) {
            const cartItem = this.cart.find((item) => item.id === lesson.id);
            const quantityInCart = cartItem ? cartItem.quantity : 0;
            return Math.max(0, lesson.spaces - quantityInCart);
          },
          addToCart(lesson) {
            if (this.getAvailableSpaces(lesson) === 0) {
              return;
            }

            const existingItem = this.cart.find(
              (item) => item.id === lesson.id
            );

            if (existingItem) {
              existingItem.quantity += 1;
            } else {
              this.cart.push({
                ...lesson,
                quantity: 1,
              });
            }

            console.log("Cart updated:", this.cart);
          },
          removeFromCart(lessonId) {
            this.cart = this.cart.filter((item) => item.id !== lessonId);
            console.log("Item removed from cart:", this.cart);
          },
          decreaseQuantity(lessonId) {
            const item = this.cart.find((item) => item.id === lessonId);
            if (item && item.quantity > 1) {
              item.quantity -= 1;
            }
            console.log("Cart updated:", this.cart);
          },
          increaseQuantity(lesson) {
            if (this.getAvailableSpaces(lesson) > 0) {
              const item = this.cart.find((item) => item.id === lesson.id);
              if (item) {
                item.quantity += 1;
              }
            }
            console.log("Cart updated:", this.cart);
          },
        },
      });
    </script>
  </body>
</html>
